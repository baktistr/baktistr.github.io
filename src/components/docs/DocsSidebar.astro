---
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');
const docsByCategory = allDocs
  .filter((doc) => !doc.data.draft)
  .reduce((acc, doc) => {
    const category = doc.data.category;
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(doc);
    return acc;
  }, {} as Record<string, typeof allDocs>);

// Sort categories and docs
const sortedCategories = Object.keys(docsByCategory).sort();
for (const category in docsByCategory) {
  docsByCategory[category].sort((a, b) => a.data.order - b.data.order);
}
---

<aside class="w-64 shrink-0 hidden lg:block sticky top-20 h-[calc(100vh-5rem)] overflow-y-auto pr-4">
  <nav class="space-y-6">
    {
      sortedCategories.map((category) => (
        <div>
          <h3 class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">
            {category}
          </h3>
          <ul class="space-y-1">
            {docsByCategory[category].map((doc) => (
              <li>
                <a
                  href={`/docs/${doc.slug}`}
                  class="block px-3 py-1.5 rounded-md text-sm transition-colors text-slate-400 light:text-slate-600 hover:bg-slate-900 light:hover:bg-slate-100 hover:text-cyan-400 light:hover:text-cyan-600"
                >
                  {doc.data.title}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))
    }
  </nav>
</aside>
